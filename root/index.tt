<!DOCTYPE HTML>
<html lang=en>
  <head>
    <title>Status Shooter</title>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8" />
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.colorbox.js"></script>
    <script type="text/javascript">
$(document).ready(function(){
  $("#debug_btn").colorbox({
    width:"85%",
    height:"50%",
    inline:true,
    opacity:0.5,
    href:"#debug_info",
  });
  $(".post_btn").colorbox({
    width:"85%",
    height:"50%",
    inline:true,
    opacity:0.5,
    href:"#update_form",
    onComplete:function(){
      $("#status").val('');
      $(".services").val([]);
      $("#status").focus();
    }
  });
});
function twitter_reply( author, id ) {
  $("#status").val(author);
  $("#twitter_in_reply_to").val(id);
  $(".services").val([]);
  $(".services").val(["twitter"]);
  $(".reply_btn").colorbox({
    width:"85%",
    height:"50%",
    inline:true,
    opacity:0.5,
    href:"#update_form",
    onComplete:function(){ $("#status").focus(); }
  });
  return true;
}
function identica_reply( author, id ) {
  $("#status").val(author);
  $("#identica_in_reply_to").val(id);
  $(".services").val([]);
  $(".services").val(["identica"]);
  $(".reply_btn").colorbox({
    width:"85%",
    height:"50%",
    inline:true,
    opacity:0.5,
    href:"#update_form",
    onComplete:function(){ $("#status").focus(); }
  });
  return true;
}
function facebook_reply( author , id ) {
  window.alert( "Facebook reply not yet implemented." );
  return true;
}
    </script>
    <link type="text/css" media="screen" rel="stylesheet" href="/css/colorbox.css" />
  </head>
  <body style="font-family:verdana,helvetica">
    <div style="text-align:center">
      <div style="font-size:2em">Status Shooter</div>
      <img src="/images/post.png" class=post_btn alt="post" title="post"/>
      <a href="[% c.uri_for() %]"><img src="/images/reload.png" alt="reload" title="reload" style="border:0"/></a>
      <img src="/images/debug.png" id=debug_btn alt="debug" title="debug"/>
    </div>
    [% IF message %]<h2 class="message" style="text-align:center">[% message %]</h2>[% END %]
    [% IF posts %]
    <div style="font-size:8pt;width:50%;margin-left:25%">
      <ul style="list-style:none">
      [% INCLUDE POST FOREACH post IN posts %]
      </ul>
    </div>
    [% END %]

    <div style="display:none">
      <div id="debug_info" style="text-align:center">
        <h1>
          [% USE date %]
          Current epoch time: [% date.now %]<br/>
          Epoch time of this page load: [% c.session.time %]<br/>
          Max Twitter post id observed: [% c.session.twitter_max %]<br/>
          Max Identi.ca post id observed: [% c.session.identica_max %]
        </h1>
        <a href=[% c.uri_for( 'delete_session' ) %]>clear session data</a>
      </div>

      <div id="update_form" style="text-align:center">

        [% FOR field IN form.error_fields %]
          [% FOR error IN field.errors %]
            <h2 class="error">[% error %]</h2>
          [% END %]
        [% END %]

        <form name=[% form.name %] action=[% form.action %] method=post>

          [% f = form.field( 'status' ) %]
          <p>
            <input type=[% f.type | lower %] name=[% f.name %] id=[% f.name %] size=[% f.size %] maxlength=[% f.maxlength %] value="[% f.fif %]" />
          </p>

          [% f = form.field( 'services' ) %]
          <p>
            [% FOR option IN f.options %]
            <label>
              <input type=checkbox class=[% f.name %] name=[% f.name %] id=[% f.name _ '.' _ option.value %] value=[% option.value %]
                     [%- FOR fif IN f.fif %][% IF option.value == fif %] checked=checked[% END %][% END %] />
              <img src=/images/[% option.value %].png height=32 width=32 alt="[% option.label %]" title="[% option.label %]" />
            </label>
            [% END %]
          </p>

          [% f = form.field( 'submit' ) %]
          <p>
            <input type=[% f.type | lower %] name=[% f.name %] id=[% f.name %] value="[% f.value %]" />
          </p>

<!--
          <hr style="width:60%;margin-top:50px;"/>
          [% f = form.field( 'body' ) %]
          <p>
            <label>Blog Post Body:<br/>
              <textarea name=[% f.name %] id=[% f.name %] rows=[% f.rows %] cols=[% f.cols %]>[% f.value %]</textarea>
            </label>
          </p>

          [% f = form.field( 'tags' ) %]
          <p>
            <label>Blog Post Tags:<br/>
              <input type=[% f.type | lower %] name=[% f.name %] id=[% f.name %] size=[% f.size %] value="[% f.fif %]" />
            </label>
          </p>

-->
          <p>
          [% f = form.field( 'identica_in_reply_to' ) %]
            <input type=[% f.type | lower %] name=[% f.name %] id=[% f.name %] value="[% f.fif %]" />
          [% f = form.field( 'twitter_in_reply_to' ) %]
            <input type=[% f.type | lower %] name=[% f.name %] id=[% f.name %] value="[% f.fif %]" />
          </p>
        </form>
      </div>
    </div>
  </body>
[% BLOCK POST %]
<li style="margin-bottom:10px">
  <div style="clear:both">
    <img src=/images/[% post.type | lower %].png height=32 width=32 style="float:left;margin:10px;" alt="[% post.type %]" title="[% post.type %]" />
    <div style="float:left;width:50px;text-align:center;vertical-align:middle;margin-top:5px">
      [% IF post.favorited %][% link = 'Unfavorite' ; img='fave_on.png' %]
      [% ELSE %][% link = 'Favorite' ; img = 'fave_off.png' %][% END %]
      [% IF post.can_be_favorited %]
      <a href="[% c.uri_for( 'toggle_fave' , post.type , post.id ) %]"><img src=/images/[% img %] style="border:0" alt=[% link %] title=[% link %] height=16 width=16/></a>
      [% END %]
      [% IF post.is_protected %]<img src=/images/lock.png alt="Protected post" title="Protected post" height=16 width=16/>
      [% ELSE %]<a href="[% c.uri_for( 'toggle_recycle' , post.type , post.id ) %]"><img src=/images/recycle.png style="border:0" alt=Recycle title=Recycle height=20 width=20 /></a>
      [% END %]
      <br/>
      <a href=# class=reply_btn onclick="[% post.type | lower %]_reply('@[% post.user_handle %] ' , '[% post.id %]' )"><img src=/images/reply.png alt=Reply title=Reply style="border:0" height=16 width=16 /></a>
    </div>
    <a href=[% post.user_url %] target="_new">
      <img src=[% post.avatar_src %] style="border:1px solid black;float:left;margin:5px;" title="[% post.user_desc %]" height=48 width=48/>
    </a>
    <div style="margin-left: 60px">
    [% IF post.retweeter %]<img src=/images/recycle.png style="border:0" alt=Retweeted title=Retweeted height=12 width=12 />[% END %]
      <a href=[% post.user_url %] class=user title="[% post.author %]" target="_new">[% post.user_handle %]</a>
      [% post.text %]
      <br/>
      <span style="font-size:0.8em">
        at <a href=[% post.permalink %] target="_new">[% post.pretty_date %]</a>
        <a href=[% c.uri_for( 'inspect' , post.type , post.id ) %] target="_new"><img src=/images/inspect.png height=16 width=16 alt=inspect title=inspect/ style="border:0"></a>
        [% IF post.retweeter %]Retweeted by <a href=[% post.retweeter_url %]>[% post.retweeter.screen_name %]</a>[% END %]
      </span>
    </div>
  </div>
</li>
[% END %]
</html>
